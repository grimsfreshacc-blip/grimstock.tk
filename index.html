<!DOCTYPE html>
<html>
<head>
  <title>GrimStock Store</title>
  <link rel="stylesheet" href="style.css">
  <script src="js/auth.js"></script>
  <script src="js/roles.js"></script>
</head>
<body>

<!-- Header -->
<header>
  <div class="logo">GrimStock</div>
  <nav>
    <a href="#products">Products</a>
    <a href="#support">Support</a>
    <span id="loginStatus"></span>
    <a id="loginLink" href="buyer-login.html" style="display:none;">Login / Sign Up</a>
    <button id="logoutBtn" style="display:none;" onclick="logout()">Logout</button>
  </nav>
</header>

<!-- Products Section -->
<h1 id="products">Products</h1>
<div id="productsGrid"></div>

<!-- Modal -->
<div id="modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);color:#fff;justify-content:center;align-items:center;overflow:auto;z-index:1000;">
  <div style="background:#1c1c1c;padding:20px;border-radius:8px;border:1px solid #444;max-width:500px;width:90%;text-align:center;">
    <span style="float:right;cursor:pointer;font-weight:bold;font-size:20px;" onclick="closeModal()">X</span>
    <h2 id="modalTitle"></h2>
    <img id="modalImg" src="" style="width:200px;height:200px;object-fit:cover;border-radius:4px;margin:10px 0;">
    <p id="modalDesc"></p>
    <p id="modalPrice"></p>
    <button id="modalPurchase">Purchase via CashApp</button>
  </div>
</div>

<!-- Bottom-right Support Button -->
<a id="support" href="javascript:void(0);" style="position:fixed;bottom:20px;right:20px;background:#E63946;color:#fff;padding:12px 18px;border-radius:8px;font-weight:bold;text-decoration:none;z-index:1001;" onclick="openTawk()">Support</a>

<!-- Tawk.to Widget -->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/69429875f5aaa6197ee506c6/1jcm272l4';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
function openTawk(){ Tawk_API.maximize ? Tawk_API.maximize() : alert("Support chat loading..."); }
</script>

<!-- Products Script -->
<script>
let allProducts = [];

// Show login/logout status
if(getRole()==="buyer"){
  document.getElementById("loginStatus").innerText = "Logged in as " + getLoggedUser();
  document.getElementById("logoutBtn").style.display = "inline-block";
} else {
  document.getElementById("loginLink").style.display = "inline-block";
}

fetch('products.json')
  .then(res=>res.json())
  .then(products=>{
    allProducts = products;
    const el=document.getElementById("productsGrid");
    el.innerHTML = '';
    products.forEach(p=>{
      el.innerHTML+=`<div class="card">
        <h3>${p.title}</h3>
        <img src="${p.img}" style="width:180px;height:180px;object-fit:cover;">
        <p>${p.price}</p>
        <button onclick='viewProduct("${p.id}")'>View</button>
      </div>`;
    });
  });

function viewProduct(id){
  const p = allProducts.find(prod => prod.id === id);
  if(!p) return;

  document.getElementById("modalTitle").innerText = p.title;
  document.getElementById("modalDesc").innerText = p.desc;
  document.getElementById("modalPrice").innerText = "Price: " + p.price;
  document.getElementById("modalImg").src = p.img;

  const purchaseBtn = document.getElementById("modalPurchase");
  if(getRole() === "buyer"){ 
    purchaseBtn.disabled = false;
    purchaseBtn.onclick = function(){
      const cashapp = "https://cash.app/$YOURCASHAPP"; // replace with your link
      alert("Please send payment via CashApp and then screenshot in the support chat!");
      window.open(cashapp,"_blank");
    }
  } else {
    purchaseBtn.disabled = true;
    purchaseBtn.onclick = function(){
      alert("Please login/sign up to purchase this account!");
    }
  }

  document.getElementById("modal").style.display = "flex";
}

function closeModal(){
  document.getElementById("modal").style.display="none";
}
</script>

</body>
</html>
